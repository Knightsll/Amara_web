<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroSync Forward Test</title>
    <link rel="stylesheet" href="../test_page.css">
    <style>
        #neuroSyncResult {
            background: #111;
            color: #0f0;
            padding: 12px;
            min-height: 120px;
            border-radius: 6px;
            overflow: auto;
            white-space: pre-wrap;
        }

        #neuroSyncStatus[data-level="error"] {
            color: #e5534b;
        }

        #neuroSyncStatus[data-level="warning"] {
            color: #f0ad4e;
        }

        #neuroSyncStatus[data-level="success"] {
            color: #00c853;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
                "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div class="container">
        <h1>NeuroSync Forward Test</h1>

        <div class="section">
            <h2>NeuroSync API</h2>
            <div class="config-panel" style="display: block; padding: 16px;">
                <div class="config-item">
                    <label for="neuroSyncApiUrl">API Endpoint:</label>
                    <input type="text" id="neuroSyncApiUrl" placeholder="http://127.0.0.1:5000/audio_to_blendshapes">
                </div>
                <div class="config-item" style="margin-top: 12px;">
                    <button id="neuroSyncCancel">Cancel Current Request</button>
                </div>
                <div class="config-item" style="margin-top: 12px;">
                    <strong>Status:</strong>
                    <span id="neuroSyncStatus" data-level="info">等待TTS语音流...</span>
                </div>
                <div class="config-item" style="margin-top: 12px;">
                    <strong>Response:</strong>
                    <pre id="neuroSyncResult">(等待返回结果)</pre>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>
                Hardware Setting
                <span class="device-info">
                    <span>MAC: <strong id="displayMac"></strong></span>
                    <span>Client: <strong id="displayClient">web_test_client</strong></span>
                </span>
                <button class="toggle-button" id="toggleConfig">Edit</button>
            </h2>
            <div class="config-panel" id="configPanel">
                <div class="control-panel">
                    <div class="config-item">
                        <label for="deviceMac">Device MAC:</label>
                        <input type="text" id="deviceMac" placeholder="设备MAC地址">
                    </div>
                    <div class="config-item">
                        <label for="deviceName">Device Name:</label>
                        <input type="text" id="deviceName" value="Web测试设备" placeholder="设备名称">
                    </div>
                    <div class="config-item">
                        <label for="clientId">Client ID:</label>
                        <input type="text" id="clientId" value="web_test_client" placeholder="客户端ID">
                    </div>
                    <div class="config-item">
                        <label for="token">Auth Token:</label>
                        <input type="text" id="token" value="your-token1" placeholder="认证Token">
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>
                Connect Message
                <span class="connection-status">
                    <span>OTA: <span id="otaStatus" class="status">ota disconnected</span></span>
                    <span>WS: <span id="connectionStatus" class="status">ws disconnected</span></span>
                </span>
            </h2>
            <div class="connection-controls">
                <input type="text" id="otaUrl" value="http://127.0.0.1:8002/xiaozhi/ota/"
                    placeholder="OTA服务器地址，如：http://127.0.0.1:8002/xiaozhi/ota/" />
                <input type="text" id="serverUrl" value="ws://127.0.0.1:8000/xiaozhi/v1/"
                    placeholder="WebSocket服务器地址，如：ws://127.0.0.1:8000/xiaozhi/v1/" />
                <button id="connectButton">Connect</button>
                <button id="authTestButton">Test Auth</button>
            </div>
        </div>

        <div class="section">
            <div class="tabs">
                <button class="tab active" data-tab="text">Text Message</button>
                <button class="tab" data-tab="voice">Voice Message</button>
            </div>

            <div class="tab-content active" id="textTab">
                <div class="message-input">
                    <input type="text" id="messageInput" placeholder="Input Message..." disabled>
                    <button id="sendTextButton" disabled>Send</button>
                </div>
            </div>

            <div class="tab-content" id="voiceTab">
                <div class="audio-controls">
                    <button id="recordButton" class="record-button" disabled>Start Record</button>
                </div>
                <canvas id="audioVisualizer" class="audio-visualizer"></canvas>
            </div>
        </div>

        <div class="section">
            <h2>Chat History</h2>
            <div class="flex-container">
                <div id="conversation" class="conversation"></div>
                <div id="logContainer">
                    <div class="log-entry log-info">Ready, connect server to start...</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>3D Model Control</h2>
            <div class="model-controls">
                <input type="file" id="modelFileInput" accept=".gltf,.glb">
                <button id="unloadModelButton" disabled>Remove Model</button>
            </div>
            <div id="modelViewer" class="model-viewer"></div>
            <div id="blendshapeControls" class="blendshape-controls">
                <p class="blendshape-empty" id="blendshapeEmptyHint">Load a model with blendshapes to see controls.</p>
            </div>
            <div class="stream-status">
                <span>Stream status: <span id="streamStatus">model not loaded</span></span>
            </div>
        </div>
    </div>

    <script src="../libopus.js"></script>
    <script type="module" src="../js/test/neuroSyncTestPage.js"></script>
</body>

</html>
